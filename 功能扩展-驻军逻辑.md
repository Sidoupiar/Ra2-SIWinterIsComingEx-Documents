# 功能扩展-驻军逻辑

现在驻军支持使用步兵的武器射程了（强制启用）。

步兵的驻军武器强制使用 `OccupyWeapon` 和 `EliteOccupyWeapon` 来确定，如果没写则会认为无驻军武器，即步兵可以驻军但是无法开火。  
驻军使用自己的武器射程而非全局设置，而全局设置 `[CombatDamage]` -> `OccupyWeaponRange` 则改为指定可驻军建筑允许的最大射程。

当第一个进入建筑的单位是射程比较短的单位时需要等待一定的时间后，射程长的单位才会自动开火。  
自动开火的延迟受到 `[General]` -> `NormalTargetingDelay` 的值的影响，但不是精准影响，具体的时间会有所浮动，若要修改此值，建议修改为一个大于 `6` 的质数。

### 注意

* 暂不支持驻军通过高度差获得额外的射程。



## 一些新增的建筑微观设置

位于 `rulesmd.ini`：

```
[SomeBuildingType]
OccupyROFMultiplier=0                           ; 建筑属性 , 浮点数 , 指定该建筑中的驻军的攻击速度倍率 , 值小于等于 0 则使用全局设置中的值 , 默认值是 0
OccupyExtraRange=0                              ; 建筑属性 , 浮点数 , 指定该建筑中的驻军的攻击射程增加量 , 负数 = 减少射程 , 默认值是 0
OccupyForceRange=0                              ; 建筑属性 , 浮点数 , 在这里 , 你可以恢复以前的固定射程的逻辑 , 强制此建筑的所有驻军都使用此射程 , 当此项大于 0 时生效 , 生效时 OccupyExtraRange 仍会额外增加射程
OccupyAutoRange=yes                             ; 建筑属性 , yes/no , 是否根据建筑面积自动提升射程 , 避免驻军到拥有较大面积的建筑时步兵对外射程不足的问题
CanOccupyTypes=                                 ; 建筑属性 , 步兵单位列表 , 可以在此建筑驻军开火的步兵列表 (白名单) , 不写或留空表示所有人都可以开火
CannotOccupyTypes=                              ; 建筑属性 , 步兵单位列表 , 不可以在此建筑驻军开火的步兵列表 (黑名单) , 如果两个列表都设置了就必须同时满足两个列表才能开火 , 然后即使不能开火 , 单位也依然可以进入驻军建筑
OccupyWeapon=                                   ; 建筑属性 , 武器 , 当建筑有驻军 , 允许驻军开火 , 且没有驻军可以开火时 , 建筑会使用此武器作为驻军武器 (会受到 OccupyROFMultiplier 的影响) , 没写则禁用此功能
EliteOccupyWeapon=                              ; 建筑属性 , 武器 , 同上 , 但是是精英等级时
ForceUseOccupyWeapon=no                         ; 建筑属性 , yes/no , 是否强制使用建筑的 OccupyWeapon 武器 , 这是一个优化方案 , 在要求所有步兵都使用同一个驻军武器时 , 它的性能会比较高
                                                ; yes = 所有驻军无法使用自己的驻军武器 , 改为使用建筑的 OccupyWeapon 武器开火 , 且驻军越多开火速度越快
                                                ; 如果你没有写建筑的 OccupyWeapon , 则效果基本等同于 CanOccupyFire=no , 还请注意
```