# 类型-坐标运动轨迹

用于给坐标添加特殊的运动轨迹，使得坐标可以逐步变化。  
轨迹每帧刷新，因此可能会带来一些额外的性能开销。



## 注册

位于 `rulesmd.ini`：

```ini
[PackTypes.OffsetMotion]
0=OffsetMotion1
1=OffsetMotion2
2=OffsetMotion3
```

### 注意

* 索引从 0 开始。

* 此类型并不需要注册，只是提供了这个功能。



## 完整结构

位于 `rulesmd.ini`：

```ini
[SomeOffsetMotion]
; 基础属性
Duration=0                                      ; 整数 , 持续时间 , 这么多帧之后停止运动 , 会一直保留最终的结果 , 负数和 0 = 永久 , 默认值是 0 , 单位 : 帧
Next=                                           ; 坐标运动轨迹 , 持续时间结束之后切换至新的坐标运动轨迹 , 默认值是 空
NextReset=no                                    ; yes/no , 切换至新的坐标运动轨迹后 , 是否根据 XYZStart , RotateStart 和 RadiusStart 重置【积累的数据】 , 默认值是 no

; 坐标平移控制
XYZSpeed=0,0,0                                  ; 三个浮点数 , 坐标平移的速度 , 可以是负数 , 默认值是 0,0,0 , 单位 : 格点
                                                ; 0 旋转时 , X 增加 = 向右下平移 , Y 增加 = 向左下平移 , Z 增加 = 向上平移
XYZStart=0,0,0                                  ; 三个浮点数 , 坐标平移的起始位置 , 可以是负数 , 默认值是 0,0,0 , 单位 : 格点
XYZMax=0,0,0                                    ; 三个浮点数 , 坐标平移的最大位置 , 可以是负数 , 默认值是 0,0,0 , 单位 : 格点
XYZMin=0,0,0                                    ; 三个浮点数 , 坐标平移的最小位置 , 可以是负数 , 默认值是 0,0,0 , 单位 : 格点
XYZReciprocating=no                             ; yes/no , yes = 平移到最大值 (最小值) 时往回运动 , no = 平移到最大值时直接跳转到最小值 (运动到最小值时同理) , 默认值是 no

; 旋转运动控制
RotateSpeed=0                                   ; 浮点数 , 旋转运动的速度 , 正数 = 顺时针 , 默认值是 0 , 单位 : 度/帧
RotateStart=0                                   ; 浮点数 , 旋转运动的起始角度 , 默认值是 0 , 单位 : 度
RotateMax=360                                   ; 浮点数 , 旋转运动的最大角度 , 可以超过 360 度 , 默认值是 360 , 单位 : 度
RotateMin=0                                     ; 浮点数 , 旋转运动的最小角度 , 可以是负数 , 默认值是 0 , 单位 : 度
RotateReciprocating=no                          ; yes/no , yes = 旋转到最大值 (最小值) 时往回旋转 , no = 旋转到最大值时直接跳转到最小值 (旋转到最小值时同理) , 默认值是 no

; 径向延伸控制 , 倍率越低偏移坐标越接近 (0,0) 点 , 负数向反方向延伸
RadiusSpeed=0                                   ; 浮点数 , 径向延伸的速度 , 正数 = 向远方延伸 , 可以是负数 , 默认值是 0 , 单位 : 倍率/帧
RadiusStart=1                                   ; 浮点数 , 径向延伸的起始位置 , 可以是负数 , 默认值是 1 , 单位 : 倍率
RadiusMax=1                                     ; 浮点数 , 径向延伸的最大位置 , 可以是负数 , 默认值是 1 , 单位 : 倍率
RadiusMin=1                                     ; 浮点数 , 径向延伸的最小位置 , 可以是负数 , 默认值是 1 , 单位 : 倍率
RadiusReciprocating=no                          ; yes/no , yes = 径向到最大值 (最小值) 时往回运动 , no = 径向到最大值时直接跳转到最小值 (运动到最小值时同理) , 默认值是 no
```



## 算法

`坐标运动轨迹` 被启用后，会随着经过的帧数的增加而不断积累 `坐标平移`、`旋转角度` 和 `径向比例`。  
当需要计算 `偏移坐标` 时，会把这些 `积累的数据` 应用在 `偏移坐标` 上。

偏移坐标的计算分为三步进行：

* 首先，`平移后的偏移坐标` = `原始的偏移坐标` + `积累的坐标平移`。

* 然后，把 `平移后的偏移坐标` 放置在 `极坐标系` 中，根据 `积累的旋转角度` 和 `积累的径向比例` 进行 `旋转` 和 `缩放` 处理。

* 最后，根据 `当前的实际朝向` 再进行一次 `旋转`，得到最终的偏移坐标。