# 标记效果-标记处理

### 多层强度值叠加的标记对目标标记强度值的影响

设：

```lua
pow1  = 效果标记.当前强度值
pow2  = 目标标记.当前强度值
base  = 效果标记.Power.Bases[1]
mult  = 效果标记.Power.Mults[1]
pmax  = 效果标记.Power.Maxs[1]
pmin  = 效果标记.Power.Mins[1]
tmax  = 效果标记.Power.Maxs.Total[1]
pmax  = 效果标记.Power.Mins.Total[1]
rmax  = 效果标记.Power.Maxs.Real[1]
rmin  = 效果标记.Power.Mins.Real[1]
count = 效果标记.Effect.Counts
```

则最终结果是：

```lua
pow1 = min( max( pow1 , rmin ) , rmax )
pow2 = pow2 + count * min( max( base + pow1 * mult , pmin ) , pmax )
pow2 = min( max( pow2 , tmin ) , tmax )
```

若标记允许重复激发，则激发时附带的强度值会相互叠加，调整标记的强度值类效果不受此限制，单纯叠强度值不能激发标记，不激发便没有实际效果。



## 标记挂载 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkMark
```

挂载标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：N 项参数

参数项数与 `Effect.AcceptMarks` 的长度相匹配。  
每一项都是【挂载的持续时间】：单位的标记抗性有效，会改变最终附加的持续时间，附加后的持续时间会被【实际数值的上下限】限制，默认值是 `0`，单位：帧。

根据目标单位是否拥有指定的标记，会有不同的细节效果：

1. 如果目标单位没有指定的标记，则挂载此标记，挂载者为当前标记的持有者，负数 = 永久，0 = 使用标记的默认值。

2. 如果目标单位已有指定的标记，则延长此标记的持续时间，负数 = 倒扣持续时间，0 = 没作用。

在此处：  
`Power.Maxs.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Max` 的值；  
`Power.Mins.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Min` 的值。

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 挂载这些标记 , 没设置就不挂载
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 是否给单位自己挂载 , 默认值是 yes
```



## 标记激发 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkActive
```

激发标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：N 项参数

参数项数与 `Effect.AcceptMarks` 的长度相匹配。  
每一项都是【附加的强度值】：单位的标记抗性有效，会改变最终附加的强度值，附加后的强度值会被【实际数值的上下限】限制，负数 = 扣除强度值，默认值是 `0`，单位：点。

当没有设置 `Effect.AcceptMarks` 时，使用第 1 项参数为所有标记提供【附加的强度值】。

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 仅对这些标记生效 , 不写或留空表示允许任意标记
Effect.ExceptMarks=                             ; 标记列表 , 不对这些标记生效 , 如果两个列表都设置了就必须同时满足两个列表才行
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 影响当前标记 (挂载了当前标记的单位) , 默认值是 yes
Effect.Other=yes                                ; yes/no , 影响其他标记 (挂载了当前标记的单位) , 默认值是 yes
```



## 标记结束 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkAfter
```

结束标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：0 项参数

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 仅对这些标记生效 , 不写或留空表示允许任意标记
Effect.ExceptMarks=                             ; 标记列表 , 不对这些标记生效 , 如果两个列表都设置了就必须同时满足两个列表才行
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 影响当前标记 (挂载了当前标记的单位) , 默认值是 yes
Effect.Other=yes                                ; yes/no , 影响其他标记 (挂载了当前标记的单位) , 默认值是 yes
```



## 标记移除 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkRemove
```

移除标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：0 项参数

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 仅对这些标记生效 , 不写或留空表示允许任意标记
Effect.ExceptMarks=                             ; 标记列表 , 不对这些标记生效 , 如果两个列表都设置了就必须同时满足两个列表才行
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 影响当前标记 (挂载了当前标记的单位) , 默认值是 yes
Effect.Other=yes                                ; yes/no , 影响其他标记 (挂载了当前标记的单位) , 默认值是 yes
```



## 标记强度 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkPower
```

调整标记的强度值的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：N 项参数

参数项数与 `Effect.AcceptMarks` 的长度相匹配。  
每一项都是【附加的强度值】：单位的标记抗性有效，会改变最终附加的强度值，附加后的强度值会被【实际数值的上下限】限制，负数 = 扣除强度值，默认值是 `0`，单位：点。

当没有设置 `Effect.AcceptMarks` 时，使用第 1 项参数为所有标记提供【附加的强度值】。

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 仅对这些标记生效 , 不写或留空表示允许任意标记
Effect.ExceptMarks=                             ; 标记列表 , 不对这些标记生效 , 如果两个列表都设置了就必须同时满足两个列表才行
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 影响当前标记 (挂载了当前标记的单位) , 默认值是 yes
Effect.Other=yes                                ; yes/no , 影响其他标记 (挂载了当前标记的单位) , 默认值是 yes
```



## 标记转换 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkChange
```

转换标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

* 暂不支持多个标记的转换，也暂不支持进行多次标记的转换。

### 强度值转换：4 项参数

|参数|说明|
|:-:|:-|
|【持续时间】|单位的标记抗性有效，会改变最终附加的持续时间，大于 0 则使用此值替换继承的持续时间，负数 = 替换为无限，0 = 不替换，默认值是 `0`，单位：帧。|
|【持续时间增加量】|单位的标记抗性有效，会改变最终附加的持续时间，负数 = 倒扣持续时间，默认值是 `0`，单位：帧。|
|【强度值】|单位的标记抗性有效，会改变最终附加的强度值，不为 0 则使用此值替换继承的强度值，负数效果逆转（不是所有的效果都支持逆转），最终效果取决于标记的效果种类，默认值是 `0`，单位：点。|
|【强度值增加量】|单位的标记抗性有效，会改变最终附加的强度值，负数 = 倒扣强度值，默认值是 `0`，单位：点。|

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 两个动画 , 【生效时在自己身上播放的动画】【生效时在受影响单位身上播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 两个标记 , 需要被转换的标记 , 以及转换后的标记 , 没有任何一个标记就会无法发挥效果
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 是否影响单位自己 , 默认值是 yes
```



## 攻击标记挂载 <攻击>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=AttackMarkMark
```

攻击有效命中时给攻击者自身添加标记。

### 注意

* 必须实打实的命中目标单位才算数，栗如 0 伤武器就有时候无法命中目标单位，这种情况下就不会触发此效果种类。

### 强度值转换：N 项参数

参数项数与 `Effect.AcceptMarks` 的长度相匹配。  
每一项都是【挂载的持续时间】：单位的标记抗性有效，会改变最终附加的持续时间，附加后的持续时间会被【实际数值的上下限】限制，默认值是 `0`，单位：帧。

根据目标单位是否拥有指定的标记，会有不同的细节效果：

1. 如果目标单位没有指定的标记，则挂载此标记，挂载者为当前标记的持有者，负数 = 永久，0 = 使用标记的默认值。

2. 如果目标单位已有指定的标记，则延长此标记的持续时间，负数 = 倒扣持续时间，0 = 没作用。

在此处：  
`Power.Maxs.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Max` 的值；  
`Power.Mins.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Min` 的值。

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.Anims=                                   ; 动画 , 【生效时播放的动画】 , 不写就不显示动画
Effect.AcceptMarks=                             ; 标记列表 , 挂载这些标记 , 没设置就不挂载
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每次挂载标记后多长时间内无法再次挂载 , 0 = 不限制 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 帧
Effect.Owner=All                                ; 作战方归属 , 可用值 : All (无简写) , Self | S , Allies | A , Enemies | E , Neutral | N , 默认值是 All (不区分大小写)
                                                ; 当需要匹配多种作战方时 , 多个值之间使用 "," 符号连接即可 , 栗如同时匹配己方和敌方 : Self,Enemies 或 S,E (简写可以混用 , 不要有空格)
```