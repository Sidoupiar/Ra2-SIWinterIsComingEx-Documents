# 标记效果-标记处理

### 多层强度值叠加的标记对目标标记强度值的影响

设：

```lua
pow1  = 效果标记.当前强度值
pow2  = 目标标记.当前强度值
base  = 效果标记.Power.Bases[1]
mult  = 效果标记.Power.Mults[1]
pmax  = 效果标记.Power.Maxs[1]
pmin  = 效果标记.Power.Mins[1]
tmax  = 效果标记.Power.Maxs.Total[1]
pmax  = 效果标记.Power.Mins.Total[1]
rmax  = 效果标记.Power.Maxs.Real
rmin  = 效果标记.Power.Mins.Real
count = 效果标记.Effect.Counts
```

则最终结果是：

```lua
pow1 = min( max( pow1 , rmin ) , rmax )
pow2 = pow2 + count * min( max( base + pow1 * mult , pmin ) , pmax )
pow2 = min( max( pow2 , tmin ) , tmax )
```

若标记允许重复激发，则激发时附带的强度值会相互叠加，调整标记的强度值类效果不受此限制，单纯叠强度值不能激发标记，不激发便没有实际效果。



## 挂载标记 <主动>

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
Effect.Type=MarkMark
```

挂载标记的效果类型，可以影响自己本身，也可以影响周围的单位的标记。

### 注意

* 范围不要搞得太大，更不要全图，它会卡的。

### 强度值转换：N 项参数

参数项数与 `Effect.AcceptMarks` 的长度相匹配。  
每一项都是【挂载的持续时间】：单位的标记抗性有效，会改变最终附加的持续时间，附加后的持续时间会被【实际数值的上下限】限制，默认值是 `0`，单位：帧。

1. 如果目标单位没有指定的标记，则挂载此标记，挂载者为当前标记的持有者，负数 = 永久，0 = 使用标记的默认值。

2. 如果目标单位已有指定的标记，则延长此标记的持续时间，负数 = 倒扣持续时间，0 = 没作用。

在此处：  
`Power.Maxs.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Max` 的值；  
`Power.Mins.Total` 对应项的值，其中 0 = 使用标记的 `Duration.Min` 的值。

### 其他属性

位于 `rulesmd.ini`：

```ini
[SomeMarkType]
; 效果种类相关属性
Effect.AcceptMarks=                             ; 标记列表 , 挂载这些标记 , 没设置就不挂载
Effect.Counts=-1                                ; 整数 , 生效次数 , 次数耗尽会立刻进入结束状态 , 等于 0 会无法生效并直接进入结束状态 (算作次数耗尽) , 负数 = 无限次 , 默认值是 -1 , 单位 : 次
Effect.Delay=0                                  ; 整数 , 每隔这么多帧生效一次 , 小于 0 按 0 算 , 但是每一帧最多生效一次 , 默认值是 0 , 单位 : 帧
Effect.Range=0                                  ; 浮点数 , 影响的范围 (半径) , 0 = 只影响挂载了当前标记的单位 , 大于 0 会影响范围内的单位的标记 , 小于 0 按 0 算 , 默认值是 0 , 单位 : 格子
Effect.Self=yes                                 ; yes/no , 是否给单位自己挂载 , 默认值是 yes
```