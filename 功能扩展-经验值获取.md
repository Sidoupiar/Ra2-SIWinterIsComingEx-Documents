# 功能扩展-经验值获取

扩展了自定义军衔的功能（强制启用）。

### 注意

* 由于逻辑冲突，已经屏蔽了 ARES 的经验值相关属性和逻辑，因此可能会丢失一些以前存在的特性（不管是不是有意为之的）。

* 此逻辑与 Phobos 的数显（显示经验值部分）不兼容，它可能会显示错误的数值。

* 有问题或改进建议请反馈。



## 全局设置

```ini
[General]
VeteranRatio=3                                  ; 浮点数 , 单位升级所需的经验值倍率 , 小于 0 视为 0 处理 , 也作为 [SomeTechnoType] -> EXPRatio 的默认值使用
VeteranCap=2                                    ; 浮点数 , 单位最多可以升级的次数 , 很难想象这个竟然是浮点数 , 虽然设置为大于 2 并不能让单位多升一级 , 但是可以让单位保存更多的经验值从而对扣经验值产生抗性
```



## 提供经验值

可以微调单位死亡后提供的经验值。

位于 `rulesmd.ini`：

```ini
[SomeTechnoType]
EXP.Provide=0                                   ; 浮点数 , 单位死亡后向击杀单位提供的经验值 , 可以是负数 , 但是负数太多可能导致单位升不了级 , 默认值是 Cost 的值 , 单位 : 点
EXP.ProvideOwner=Enemy                          ; 作战方归属 , 可用值 : All (无简写) , Self | S , Allies | A , Enemies | E , Neutral | N , 默认值是 Enemy (不区分大小写)
                                                ; 当需要匹配多种作战方时 , 多个值之间使用 "," 符号连接即可 , 栗如同时匹配己方和敌方 : Self,Enemies 或 S,E (简写可以混用 , 不要有空格)
                                                ; 只向符合作战方的单位提供经验值 , 作战方是相对于死亡单位和击杀单位的
```



## 升级经验值

可以微调单位升级所需的经验值，需要 `Trainable=yes`。

位于 `rulesmd.ini`：

```ini
[SomeTechnoType]
; 升级经验值
EXP.Cost=0                                      ; 浮点数 , 单位升级所需的经验值 , 需要大于 0 , 默认值是 Cost 的值 , 单位 : 点
EXP.CanReduce=no                                ; yes/no , 单位是否可以接受负数的经验值 , 负数经验值仍会正常分配 , 只是不起作用 , 默认值是 no
EXP.Ratio=3                                     ; 浮点数 , 单位升级所需的经验值倍率 , 小于 0 视为 0 处理 , 默认值是 [General] -> VeteranRatio 的值
EXP.Owner=Enemy                                 ; 作战方归属 , 可用值 : All (无简写) , Self | S , Allies | A , Enemies | E , Neutral | N , 默认值是 Enemy (不区分大小写)
                                                ; 当需要匹配多种作战方时 , 多个值之间使用 "," 符号连接即可 , 栗如同时匹配己方和敌方 : Self,Enemies 或 S,E (简写可以混用 , 不要有空格)
                                                ; 只吸收符合作战方的单位的经验值 , 作战方是相对于死亡单位和实际获得经验值的单位的
; 载员经验值 , 写载员和载具上
EXP.Passenger=no                                ; yes/no , 载员击杀时 , 载具是否可以获得经验值 , 默认值是 no
EXP.PassengerRatio=1                            ; 浮点数 , 载员击杀时 , 载具可以获得的经验值的比例 , 默认值是 1
EXP.PassengerRatioPass=1                        ; 浮点数 , 载员击杀时 , 载员可以获得的经验值的比例 , 默认值是 1
; 载具经验值 , 写载具上
EXP.Transport=no                                ; yes/no , 载具击杀时 , 载员是否可以获得经验值 , 平均分给各个可以升级的载员 , 默认值是 no
EXP.TransportRatio=1                            ; 浮点数 , 载具击杀时 , 载具可以获得的经验值的比例 , 默认值是 1
EXP.TransportRatioPass=1                        ; 浮点数 , 载具击杀时 , 载员可以获得的经验值的比例 (所有载员均分) , 默认值是 1
; IFV 经验值 , 写 IFV 上
EXP.IFV=no                                      ; yes/no , IFV 击杀时 , IFV 位载员是否可以获得经验值 , 默认值是 no
EXP.IFVRatio=1                                  ; 浮点数 , IFV 击杀时 , 载具可以获得的经验值的比例 , 默认值是 1
EXP.IFVRatioPass=1                              ; 浮点数 , IFV 击杀时 , IFV 位载员可以获得的经验值的比例 , 默认值是 1
; 空袭经验值 , 写空袭召唤者上
EXP.Airstrike=no                                ; yes/no , 召唤者是否可以从空袭中获得经验值 , 默认值是 no
EXP.AirstrikeRatio=1                            ; 浮点数 , 召唤者从空袭中获得的经验值的比例 , 默认值是 1
; 心控经验值 , 写心控者上
EXP.MindControl=no                              ; yes/no , 心控者是否可以获得经验值 , 默认值是 no
EXP.MindControlRatio=1                          ; 浮点数 , 心控者获得的经验值的比例 , 默认值是 1
EXP.MindRatio=1                                 ; 浮点数 , 被心控者获得的经验值的比例 , 默认值是 1
; 航母经验值 , 写航母上
EXP.SpawnOwner=no                               ; yes/no , 航母是否可以获得经验值 , 默认值是 no
EXP.SpawnOwnerRatio=0                           ; 浮点数 , 航母获得的经验值的比例 , 默认值是 0
EXP.SpawnRatio=1                                ; 浮点数 , 舰载机获得的经验值的比例 , 默认值是 1
; 驻军经验值 , 写建筑上
EXP.Occupy=no                                   ; yes/no , 驻军是否可以获得经验值 , 默认值是 no
EXP.OccupyRatio=1                               ; 浮点数 , 建筑获得的经验值的比例 , 默认值是 1
EXP.OccupantRatio=1                             ; 浮点数 , 驻军获得的经验值的比例 , 默认值是 1
```

### 注意

* 与 ARES 的特性会有一些不同：  
启用传递，那么目标单位就会获得一份等额的经验值；  
不启用传递，就不会向任何自己以外的目标传递经验值；  
对于载员通过发动空袭获得经验时，经验并不会传递给载具，则是由于实际获得经验值的单位并不是载员导致的；心控和航母同理；  
由于是重构的逻辑，因此在比较复杂的情况下，可能会出现一个单位获得好几份经验值的情况，如果遇到此种问题，请反馈。

* 对于特定的载具且载具的 `EXP.Passenger=yes` 时，载具上的经验值分配设置会覆盖载员上的。



## 其他经验值获取相关的效果

弹头：详见 [`经验值`](/功能扩展-弹头.md#弹头---经验值)。  
标记：详见 [`加成属性`](/标记逻辑/标记效果-1-杂项.md#加成属性-主动) 和 [`经验值`](/标记逻辑/标记效果-1-杂项.md#经验值-主动)。



## 与 ARES 的经验值相关属性和逻辑的兼容性

由于属性数量和实际效果并不完全一致，因此暂时不提供属性自动转换，请按需手动调整。（全文搜索 `Experience.`）

受到影响的属性有：

|属性|含义|
|:-:|:-|
|`Experience.FromPassengers`|载具里的乘客开火载具能够得到经验值。|
|`Experience.PromotePassengers`|如果载具满级那么乘客得到经验值。|
|`Experience.PassengerModifier`|如果击杀是由乘客做的，那么所得的经验值比例。|
|`Experience.FromAirstrike`|如果一个击杀由鲍里斯那样的召唤飞机做的, 召唤者能够得到经验值而不是给飞机。|
|`Experience.AirstrikeModifier`|召唤飞机摧毁对方获得的经验值比例。|
|`Experience.MindControlSelfModifier`|控制的单位摧毁敌方，控制者获得的经验值比例。|
|`Experience.MindControlVictimModifier`|控制的单位获得的经验值比例。如果控制者和战斗要塞的所有者不是盟友的话，控制战斗要塞这样的单位，里面的乘客开火摧毁敌方后获得的经验不算在里面。控制友军单位摧毁敌方，控制者不会得经验。|
|`Experience.SpawnOwnerModifier`|子机摧毁敌方单位，航母获得的经验值比例。|
|`Experience.SpawnModifier`|子机摧毁敌方单位，子机获得的经验值比例。|