# 功能扩展-弹头

## 弹头 - 失去视野

和 Phobos 的 `BigGap=` 弹头类似，但是效果是相反的，也就是说这个弹头爆炸后，弹头所属的作战方会被重置黑幕，不影响其他的作战方。  
这是我用来模拟黑雾蔓延的东西。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
BigGapSelf=no                                   ; yes/no , 启用逻辑 , 默认值是 no
```



## 弹头 - 作战方空闲单位立刻执行脚本

可以使用地图内添加的脚本。  
专门为解决 AI 堵车问题而生，用于把所有在 AI 家里待命的单位全部都派出去。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
EnterScript=no                                  ; yes/no , 启用逻辑 , 弹头引爆后 , 属于该作战方的所有无小队单位会立刻加入小队并执行指定的脚本 , 默认值是 no
EnterScript.IgnoreDock=yes                      ; yes/no , 是否影响带有 Dock 的单位 , yes = 不影响 , 不影响 EnterScript.EffectList 的选择
EnterScript.IgnoreSlaveMiner=yes                ; yes/no , 是否影响奴隶矿场 , yes = 不影响 , 不影响 EnterScript.EffectList 的选择
EnterScript.Team=                               ; AI 作战小队 , 指定单位要加入的作战小队的类型 , 每个单位一个独立的作战小队 , 如果不设定则逻辑不生效
EnterScript.Script=                             ; AI 脚本 , 指定单位要执行的脚本的类型 , 如果不指定则仅考虑 EnterScript.EffectList 的结果 , 如果指定则 EnterScript.EffectList 剩下的单位会使用此脚本
EnterScript.EffectList=                         ; 单位列表 , 步兵载具飞机 , 此为根据单位类型指定脚本的功能 , 如果不使用此部分逻辑则留空 (不写) 即可
EnterScript.ScriptList=                         ; AI 脚本列表 , 受到影响的单位要执行的脚本 , 需要与 EnterScript.EffectList 一一对应
```

### 注意

* 请确保所有脚本的动作数量都不为 0，否则可能表现结果会与意料的不同。

* 创建作战小队时不检查小队的 `MAX=`，当尝试创建超过 `MAX=` 数量的作战小队时，游戏会弹窗给你看，因此这里使用的小队的 `MAX=` 建议设置得比较高或者 `-1` 来回避这个问题。



## 弹头 - 被影响的单位立刻执行脚本

可以使用地图内添加的脚本。  
如果弹头对目标单位的护甲为 `0%`，则效果不会生效。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
TargetEnterScript=no                            ; yes/no , 启用逻辑 , 弹头引爆后 , 被命中的单位会立刻加入小队并执行指定的脚本 , 默认值是 no
TargetEnterScript.IgnoreTeam=yes                ; yes/no , 是否影响已经拥有作战小队的单位 , yes = 不影响 , 会影响 TargetEnterScript.EffectList 的选择
TargetEnterScript.IgnoreDock=yes                ; yes/no , 是否影响带有 Dock 的单位 , yes = 不影响 , 不影响 TargetEnterScript.EffectList 的选择
TargetEnterScript.IgnoreSlaveMiner=yes          ; yes/no , 是否影响奴隶矿场 , yes = 不影响 , 不影响 TargetEnterScript.EffectList 的选择
TargetEnterScript.Team=                         ; AI 作战小队 , 指定单位要加入的作战小队的类型 , 每个单位一个独立的作战小队 , 如果不设定则逻辑不生效
TargetEnterScript.Script=                       ; AI 脚本 , 指定单位要执行的脚本的类型 , 如果不指定则仅考虑 TargetEnterScript.EffectList 的结果 , 如果指定则 TargetEnterScript.EffectList 剩下的单位会使用此脚本
TargetEnterScript.EffectList=                   ; 单位列表 , 步兵载具飞机 , 此为根据单位类型指定脚本的功能 , 如果不使用此部分逻辑则留空 (不写) 即可
TargetEnterScript.ScriptList=                   ; AI 脚本列表 , 受到影响的单位要执行的脚本 , 需要与 TargetEnterScript.EffectList 一一对应
```

### 注意

* 目前不建议用于协助 AI 控制单位。

* 请确保所有脚本的动作数量都不为 0，否则可能表现结果会与意料的不同。

* 创建作战小队时不检查小队的 `MAX=`，当尝试创建超过 `MAX=` 数量的作战小队时，游戏会弹窗给你看，因此这里使用的小队的 `MAX=` 建议设置得比较高或者 `-1` 来回避这个问题。



## 弹头 - 真实伤害

对目标造成无视防御的真实伤害，对本来就是真实伤害的攻击无效。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
RealDamage=no                                   ; yes/no , 启用逻辑 , 默认值是 no
RealDamageAmount=0                              ; 浮点数 , 不为 0 则使用此值覆盖原本的伤害 (它竟然支持浮点数伤害) , 默认值是 0
```

### 注意

* 这里处理的是原始伤害。



## 弹头 - 最终归零

对目标造成的伤害最终会变为 0。  
会正常结算其他的伤害损耗，比如对护盾的消耗等。  
这是一个特殊情况下的优化项目。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
FinalZero=no                                    ; yes/no , 启用逻辑 , 默认值是 no
```



## 弹头 - 单位转换

变形可以把单位变形为任意单位。

位于 `rulesmd.ini`：

```ini
[SomeWarheadType]
SuperConvert=no                                 ; yes/no , 启用逻辑 , 默认值是 no
SuperConvertAffectOwner=All                     ; 作战方归属 , 需要作战方匹配才能影响目标单位
                                                ; 可用值 : All (无简写) , Self | S , Allies | A , Enemies | E , Neutral | N , 默认值是 All (不区分大小写)
                                                ; 当需要匹配多种作战方时 , 多个值之间使用 "," 符号连接即可 , 栗如同时匹配己方和敌方 : Self,Enemies 或 S,E (简写可以混用 , 不要有空格)
SuperConvertFrom=                               ; 单位列表 , 只给这些单位变形 (影响这些单位) , 不写就是任意单位
SuperConvertTo=                                 ; 单位列表 , 变形为这些单位 , 随机选择 , 不写就无法变形 , 默认值是 空
SuperConvertWeight=1                            ; 整数列表 , 选择变形结果的权重 , 小于 0 视为 0 处理 , 默认值是 0
                                                ; 如果所有权重都是 0 时 , 则单位转化的列表是一一对应的
SuperConvertOnMap=yes                           ; yes/no , 要求仅当单位在地图上时才能进行变形 , 默认值是 yes
SuperConvertOwner=no                            ; yes/no , 是否变为攻击者所属的作战方 , 默认值是 no
SuperConvertOwnerOther=yes                      ; yes/no , 弹头影响了这个单位但是并未变形时 (包括没有合适的变形结果) , 是否直接转换单位的作战方 , 默认值是 yes
SuperConvertAnims=                              ; 动画列表 , 转换成功时播放这些动画 , 默认值是 空
```

由于一些原因，对于变形有一些特殊的处理：

|序号|说明|
|:-:|:-|
|1|子机、奴隶、被超时空武器冻结的单位无法变形，无法变形为自己（不要用此逻辑刷新单位）。|
|2|如果变形后目标位置放不下这个单位，则不会变形（这可能有多种情况，比如地方不足、载员的 `Size` 过大、新单位不能驻军、作战方不匹配、无法在水上等等）。|
|3|对于已有载员的单位，如果新的类型没有载员或载员数量小于原来的，则会把载员弹出，且只有同归属的载员才会转移（驻军同理）。|
|4|作为载员时，无法变形为建筑和飞机，且需要同归属；作为驻军时，无法变形为步兵以外的类型，且需要同归属。|
|5|对于有子机的单位，当前的子机会全部报废。|
|6|对于有奴隶的单位，当前的奴隶会全部免费。|
|7|对于被心控的单位，心控权会同步；如果新的类型能免疫心控，则单位会被释放。|
|8|对于有心控能力的单位，心控权会转移；如果新的类型没有心控能力，则被心控的单位会被释放；如果心控数量小于原来的，则超过的部分会被释放。|
|9|对于有超时空冻结能力的单位，当前正在冻结的单位会被释放。**如果使用超时空冻结武器进行了变形的话，你大概率会获得一枚梦寐以求的弹窗（0071AACD）。**|
|10|对于正在执行任务的单位，新的单位会尝试替换进原来的作战小队，但是此操作可能失败，作战小队可能会拒绝新单位的加入。|
|11|对于当前正在被选中的单位，则自动替换选择了；如果新的类型无法被选择，则会取消选择。|
|12|变形无法改变军衔图像，仍旧使用原始单位的军衔图像。|
|13|由于建筑必须在格子中，因此变形为建筑后，单位可能会有小幅度的位移。|
|14|变形后，AE 等效果无法继承，标记会根据设置进行继承，各种[加成属性](/标记逻辑/标记效果-1-杂项.md#加成属性-主动)和[经验值](/经验值与升级与军衔图像/属性-单位.md#获取经验值)也会正常继承。|
|15|如果变形前，攻击单位或目标单位就已经消失了（不论何种原因），那么变形会失败。|

（在后续的调整中，这些处理可能会有所变化，另见 [迁移说明](/迁移说明.md#迁移说明)）